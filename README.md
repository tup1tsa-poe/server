# poe-trade-server
you should start server.ts server from the server directory

todo: 
1) make step-by-step guide how install this app from scratch (dev or prod version)

Current status:
- frontend: almost empty (should be react app)
- backend: 
    - filters: not implemented
    - item saves to db: not implemented
    
In order to start mongo run "sudo service mongod start". All settings should be in mongod.conf in etc folder.




<h3>Application internal notes </h3>
<h4>Collections</h4>



<h5>Modifiers</h5>
Example of modifier:
<ul>
    <li>unique id (generated by application, not mongodb)</li>
    <li>type (explicit, implicit, etc)</li>
    <li>itemTypes: ['helmet', 'maps', 'gloves']</li>
    <li>uniques: ['queen of the forest', 'belly of the beast'].</li>
</ul>
There is no point in referencing those types or uniques ('sql join'). <br />
It's much easier to duplicate data.<br />
Modifiers should also have custom total modifiers.



<h5>NamesAndDescriptions</h5>
Small collection for saving non important stuff. Should be indexed by id. Id - 32 bit integer.<br />
Values can be either arrays of string or just strings.



<h5>Items</h5>   
Every item value should be shrinked as much as possible.<br />
This is especially important for indexed values.<br />
Item structure would be a little different than raw item from official api response.<br />
Interface for internal item should be implemented and described here.<br />
In order to increase searching speed in this collection - put some limitations 
(e.g.: 100,000 for sort, and 100 to display).


Item structure:
<h6>Ids: indexed</h6>
Every item would have regular mongodb db Object id (indexed) and 48 hex original id, stored as string(not indexed)<br />
Item should also store  parent stash id (this would be 32 bit integer). It would be indexed too.


<h6>Requirements: indexed</h6>
Every requirement should be stored separately.<br />
Sparsed indices should be used.<br />
Example: ReqStr: 23; ReqDex: 23; ReqInt: 223; ReqLvl: 23.<br />
Attrs requirements are quite rare (e.g.: around 15% to have str requirement). Every second item has lvl requirement.


<h6>Modifiers: indexed</h6>
Example: 
<code>
[
    {"id":23, "value":47},
    {"id":232, "value":232},
    {"id"23, "value":null}
]
</code><br />
Ids - links to modifiers table. Value can be omitted (some modifiers doesn't have values at all). <br />
If modifier has multiple values (e.g.: 'Adds 2 to 5 physical damage to attacks'), average should be saved. <br />
If modifier has 3 values (e.g.: '1% increased Movement Speed per 450 Evasion Rating, up to 100%'), it
shouldn't have any value.<br />
Complex total modifiers (e.g.: '+# to maximum life') contain a lot of variations (expl. life, impl. life, str).<br />
In order to decrease query size for those 'total' modifiers they should be stored as regular modifiers. <br/>
Modifiers should be indexed as arrays. <br />
<code>
{
    "mods.id : 1.0,
    "mods.value" : 1.0
}
</code>


<h6>Category: indexed</h6>
Two letters values. It's easy to save categories contractions inside code. No point in making 'join'.<br />
E.g.: ta - two handed axe, aj - abyss jewel (abyss jewel should be category, not boolean)
<h6>Additional data: indexed</h6>
It could be done with parsed indexes.
<ul>
    <li>corrupted</li>
    <li>elder</li>
    <li>duplicated</li>
    <li>shaped</li>
    <li>identified</li>
    <li>isRelic: not important but super rare, so it's easy to index</li>
</ul>
Other booleans, like 'support' would not be indexed.


<h6>Sockets: indexed</h6>
Create array of sockets data.<br />
[{totalSockets: number}, {white: number}, ... {totalLinks: number}, {greenLinks: number}...]
Index as multikey


<h6>Item properties: indexed</h6>
how it should be saved - not decided. Probably sparsed indices (same as requirements).<br />
Defence properties, offence and ilvl should be here.


<h6>Name: indexed</h6>
all names should be stored in special collection. Value here - 32 bit integer ('id')


<h6>Price calculated: indexed</h6>
Item should have regular price (not indexed) and converted to exalted with some (probably high) precision (indexed).<br />
If converted price was changed (e.g.: price was 100 chaos (around 1 ex), and after exalted rise price became 0.9ex) -
DO NOT CHANGE converted price. Only if regular price was changed. Currency rate would be different every other day.


<h6>Frametype: indexed</h6>
Rarity or type of item


<h6>Other: not indexed</h6>
All other properties go here. There is no sense in saving modifiers.<br />
If value is a number - it's link to description collection.
